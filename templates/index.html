<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Monitor IoT - ESP32</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial; background: #f2f2f2; padding: 20px; }
        h1, h2 { text-align: center; }
        canvas { background: #fff; border: 1px solid #ccc; margin: 20px auto; display: block; }
        .sensor { text-align: center; margin-bottom: 40px; }
        .sensor img { height: 100px; margin-bottom: 10px; }
        .botones { text-align: center; margin-top: 40px; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>Monitor IoT - ESP32</h1>

    <div class="sensor">
        <img src="/static/img/temp.png" alt="Temperatura">
        <h2>Temperatura (¬∞C)</h2>
        <canvas id="chartTemperatura"></canvas>
    </div>

    <div class="sensor">
        <img src="/static/img/humedad.png" alt="Humedad">
        <h2>Humedad (%)</h2>
        <canvas id="chartHumedad"></canvas>
    </div>

    <div class="sensor">
        <img src="/static/img/presion.png" alt="Presi√≥n">
        <h2>Presi√≥n (hPa)</h2>
        <canvas id="chartPresion"></canvas>
    </div>

    <div class="sensor">
        <img src="/static/img/luz.png" alt="Luz">
        <h2>Radiaci√≥n UV (lux)</h2>
        <canvas id="chartLuz"></canvas>
    </div>

    <div class="sensor">
        <img src="/static/img/aire.png" alt="Calidad Aire">
        <h2>Calidad del Aire</h2>
        <canvas id="chartAire"></canvas>
    </div>

    <div class="botones">
        <form action="/exportar_csv" method="get">
            <button type="submit">üìÅ Exportar datos a CSV</button>
        </form>
        <form action="/eliminar_datos" method="post">
            <button type="submit" onclick="return confirm('¬øEst√°s seguro?')">üóëÔ∏è Eliminar todos los datos</button>
        </form>
    </div>

    <script>
        async function cargarDatos() {
            const res = await fetch('/ver_datos_json');
            const datos = await res.json();

            const labels = datos.map(d => d.fecha_hora);
            const temperaturas = datos.map(d => d.temperatura);
            const humedades = datos.map(d => d.humedad);
            const presiones = datos.map(d => d.presion);
            const luces = datos.map(d => d.radiacion_uv);
            const aires = datos.map(d => d.calidad_aire);

            const opciones = (label, color) => ({
                type: 'line',
                data: { labels, datasets: [{ label, data: eval(label.toLowerCase()), borderColor: color, tension: 0.3 }] },
                options: { scales: { x: { ticks: { maxRotation: 90, minRotation: 45 } } } }
            });

            new Chart(document.getElementById('chartTemperatura'), opciones('Temperaturas', 'red'));
            new Chart(document.getElementById('chartHumedad'), opciones('Humedades', 'blue'));
            new Chart(document.getElementById('chartPresion'), opciones('Presiones', 'green'));
            new Chart(document.getElementById('chartLuz'), opciones('Luces', 'orange'));
            new Chart(document.getElementById('chartAire'), opciones('Aires', 'brown'));
        }

        cargarDatos();
        setInterval(cargarDatos, 30000);
    </script>
</body>
</html>
